<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>主页 | Solarck</title>

    <meta name="author" content="Kevin Chen"/>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css"/>
    <link rel="stylesheet" href="https://www.solarck.com/theme/css/jquery.mglass.css"/>
    <link rel="stylesheet" href="https://www.solarck.com/theme/css/pygment-solarized-dark.css"/>
    <link rel="stylesheet" href="https://www.solarck.com/theme/css/style.css"/>

    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Istok+Web' rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Droid+Sans+Mono' rel='stylesheet' type='text/css'/>
      <link href='https://fonts.googleapis.com/css?family=Expletus+Sans' rel='stylesheet' type='text/css'>


    <link rel="icon" href="https://www.solarck.com/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://www.solarck.com/favicon.ico" type="image/x-icon">

    <!-- Feeds -->
      <link href="https://www.solarck.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Solarck - All posts - Atom Feed"/>


  </head>

  <body>

    <div class="container">

      <div class="page-header">
          <a href="https://www.solarck.com" class="avatar-container pull-left">
            <div class="avatar ">
              <div class="side"><img src="https://www.solarck.com/static/avatar.jpg" class="img-responsive"/></div>
            </div>
          </a>
        <h1><a href="https://www.solarck.com">Solarck</a> <small>金融民工与程序猿的结合体</small></h1>
      </div>

      <nav class="navbar navbar-default">

        <!-- Hamburger menu for mobile -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#plumage-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://www.solarck.com" title="金融民工与程序猿的结合体">Solarck</a>
        </div>

        <!-- Menus and search forms -->
        <div class="collapse navbar-collapse" id="plumage-navbar-collapse-1">

          <ul class="nav navbar-nav">
<li >
                  <a href="https://www.solarck.com/category/itbi-ji.html">IT笔记</a>
                </li>
<li >
                  <a href="https://www.solarck.com/category/jin-rong-bi-ji.html">金融笔记</a>
                </li>
<li >
                  <a href="https://www.solarck.com/pages/aboutme.html">关于我</a>
                </li>
<li >
                  <a href="https://www.solarck.com/pages/resume.html">简历</a>
                </li>

          </ul>


            <form class="navbar-form navbar-right" role="search" action="https://www.solarck.com/search.html" onsubmit="return validateForm(this.elements['q'].value);">
              <div class="form-group">
                <div class="input-group">
                  <input type="text" name="q" id="tipue_search_input" class="form-control search-query" placeholder="Search" required />
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fa
                        fa-search fa-fw"></i></button>
                  </span>
                </div>
              </div>
            </form>

        </div>

      </nav>

    </div>


    <div class="container main">


      <div class="row">
        <div class=" col-md-12  ">
        </div>
      </div>

      <div class="row">


        <div class=" col-md-12 " id="content" role="main">

    <article>
      <header>
        <h2><a href="https://www.solarck.com/systemd-wait-network-online.html" rel="bookmark" title="Permalink to 解决Haproxy用Systemd启动失败的问题">解决Haproxy用Systemd启动失败的问题</a></h2>
      </header>
      <div><h1 id="wen-ti-miao-shu">问题描述</h1>
<p>配置好Haproxy的配置文件，手动可以无错误开启，但是<code>Systemctl enable haproxy.service</code>开机启动每次都报错，系统启动后，手动开启还是没有问题。</p>
<h1 id="fen-xi-yuan-yin">分析原因</h1>
<h3 id="haproxypei-zhi-wen-ti">haproxy配置问题</h3>
<p><code>/etc/haproxy.cfg</code>是配置文件，因为手动指定配合文件可以启动，而且测试配置文件也没有报错或警报，所以首先排除是配置的问题。</p>
<h3 id="systemdfu-wu-pei-zhi-wen-ti">systemd服务配置问题</h3>
<p><code>haproxy.service</code>是systemd用来启动服务的配置文件，第一眼看配置后，以为是创建PID没有权限，增加<code>User=root</code>字段，但是重启后依然报错。原版配置只有<code>After=network.target</code>，手动添加<code>Wants=network.target</code>重启后，依然报错。</p>
<h3 id="cha-kan-ri-zhi">查看日志</h3>
<p>正要灰心的时候，决定最后一搏，查看systemd启动日志，看看能不能找到点线索。</p>
<p>查看最近一次启动中haproxy的日志</p>
<p><code>journalctl -b -0 …</code></p></div>
      <div><a class="btn btn-primary" href="https://www.solarck.com/systemd-wait-network-online.html"><strong>➟ 查看全文</strong></a></div>
    </article>
    <hr/>
    <article>
      <header>
        <h2><a href="https://www.solarck.com/v2ray-quick-config.html" rel="bookmark" title="Permalink to 快速配置V2ray">快速配置V2ray</a></h2>
      </header>
      <div><h1 id="fu-wu-qi-duan-pei-zhi">服务器端配置</h1>
<p>服务器系统使用的是Debian 9&nbsp;x86_64，Ubuntu大部分操作都通用。如果是CentOS的话，该文章仅作为参考。</p>
<h3 id="you-hua-wang-luo">优化网络</h3>
<p>主要涉及bbr的安装配置，需要VPS是KVM架构，具体可以参照<a href="https://www.solarck.com/shadowsocks-libev.html">之前的文章</a>。</p>
<h3 id="an-zhuang-v2ray">安装V2ray</h3>
<p>官方提供了安装脚本，需要系统使用systemd管理系统</p>
<div class="highlight"><pre><span></span>wget https://install.direct/go.sh
bash go.sh
</pre></div>
<p>安装好后，主要文件如下：</p>
<blockquote>
<p><code>/etc/systemd/system/v2ray.service</code>：启动服务
<code>/etc/v2ray/config.json</code>：配置文件
<code>/usr/bin/v2ray/v2ray</code>：主程序</p>
</blockquote>
<h3 id="tlsyu-ming-zheng-shu">TLS域名证书</h3>
<p>因为最终配置要用到TLS链接，在这步之前，你需要一个域名，免费的也无所谓。</p>
<p>工具使用<a href="https://github.com/Neilpang/acme.sh/wiki">acme.sh …</a></p></div>
      <div><a class="btn btn-primary" href="https://www.solarck.com/v2ray-quick-config.html"><strong>➟ 查看全文</strong></a></div>
    </article>
    <hr/>
    <article>
      <header>
        <h2><a href="https://www.solarck.com/lede-media-center2.html" rel="bookmark" title="Permalink to LEDE/OpenWRT路由器打造家庭媒体影音中心（二）"><span class="caps">LEDE</span>/OpenWRT路由器打造家庭媒体影音中心（二）</a></h2>
      </header>
      <div><h1 id="usbqu-dong">USB驱动</h1>
<h3 id="cha-kan-yi-an-zhuang-de-qu-dong">查看已安装的驱动</h3>
<div class="highlight"><pre><span></span>opkg update
opkg list-installed | grep usb
</pre></div>
<h3 id="an-zhuang-qu-dong-he-gong-ju">安装驱动和工具</h3>
<p>如果下列驱动未出现在上一步的结果中，请务必首先安装缺失的驱动</p>
<div class="highlight"><pre><span></span>opkg install kmod-usb-core kmod-usb-storage
</pre></div>
<p><code>kmod-usb-core</code>:USB核心驱动</p>
<p><code>kmod-usb-storage</code>:大容量存储设备驱动</p>
<p><code>kmod-usb2</code>:WRT1900ACS有一个USB2.0/eSATA口，可以不安装</p>
<p><code>kmod-ata-marvell-sata</code>:Marvell&nbsp;SATA接口驱动，可以不安装</p>
<p>网上搜到的教程和官方指南里还让安装一些其他的应用，但这些都是不必要或已被编译至内核中，包括：<code>kmod-usb-ohci</code>、<code>kmod-usb-uhci</code>、<code>kmod-usb3</code>、<code>kmod-usb-storage-uas</code></p>
<h3 id="an-zhuang-xiang-guan-gong-ju">安装相关工具</h3>
<div class="highlight"><pre><span></span>opkg install usbutils block-mount e2fsprogs kmod-fs-ext4 gdisk fdisk 
</pre></div>
<p><code>mount-utils</code>:提供unmount,findmnt</p>
<p><code>usbutils</code>:提供lsusb</p>
<p><code>block-mount …</code></p></div>
      <div><a class="btn btn-primary" href="https://www.solarck.com/lede-media-center2.html"><strong>➟ 查看全文</strong></a></div>
    </article>
    <hr/>
    <article>
      <header>
        <h2><a href="https://www.solarck.com/lede-media-center1.html" rel="bookmark" title="Permalink to LEDE/OpenWRT路由器打造家庭媒体影音中心（一）"><span class="caps">LEDE</span>/OpenWRT路由器打造家庭媒体影音中心（一）</a></h2>
      </header>
      <div><h1 id="qian-yan">前言</h1>
<h3 id="ruan-ying-jian">软/硬件</h3>
<p>软件：本文系统都是基于LEDE&nbsp;17.01.4</p>
<p>硬件：Linksys <span class="caps">WRT1900ACS</span>&nbsp;V2</p>
<p>其他：一台电脑，最好是Linux带SSH，Windows的话可以下个putty安装上</p>
<p>前提：我不会从头写起，而是从路由器已刷好LEDE&nbsp;17.01.4，WAN口已联网，且已经可以SSH登录之后开始，其他外设，如硬盘、硬盘盒、用于Extroot的U盘都已准备好。</p>
<h3 id="shi-xian-mu-de">实现目的</h3>
<p>基于Linksys&nbsp;WRT1900ACS强悍的性能和扩展功能丰富的LEDE，打造一个有权限控制的NAS，支持DLNA，可以离线下载和远程访问的DDNS系统的多媒体中心。</p>
<h1 id="extroot_1">Extroot</h1>
<p>extroot的作用就是扩充存储空间，这样就可以安装更多的软件。详细介绍可以查看很早之前我写过的一篇文章&mdash;&mdash;<a href="https://solarck.com/openwrt-extroot.html">用extroot为openwrt扩充存储空间</a>，这里就不赘述了。由于那篇文章比较老，LEDE也早已经升级了好几个含本，所以实际的操作还是以下面的内容为主。</p>
<h3 id="an-zhuang-gong-ju">安装工具</h3>
<p>这里我准备把U盘格式化为f2fs格式，关于各种存储格式和下面需要安装的工具的作用，我会放在下一篇文章一起讲，这一步照着做就可以了。</p>
<div class="highlight"><pre><span></span>opkg update …</pre></div></div>
      <div><a class="btn btn-primary" href="https://www.solarck.com/lede-media-center1.html"><strong>➟ 查看全文</strong></a></div>
    </article>
    <hr/>
    <article>
      <header>
        <h2><a href="https://www.solarck.com/centos6-datebase-server.html" rel="bookmark" title="Permalink to CentOS6数据库服务器配置">CentOS6数据库服务器配置</a></h2>
      </header>
      <div><p>本文章仅用于记录在公司服务器上通过yum&nbsp;repo来安装官方提供的数据库程序，而非通过编译方式来安装。通过官方仓库来安装有很多好处，比如升级、打补丁都很方便，不用编译浪费时间，更不需要安装多个版本的gcc来满足各种不同软件的要求。</p>
<h3 id="mysql">Mysql</h3>
<h4 id="xia-zai-an-zhuang-mysql-repo"><strong>下载安装mysql&nbsp;repo</strong></h4>
<p><code>rpm -Uvh https://repo.mysql.com//mysql80-community-release-el6-1.noarch.rpm</code></p>
<h4 id="sheng-ji-zhi-57ban-ben"><strong>升级至57版本</strong></h4>
<p><code>yum --disablerepo=mysql80-community --enablerepo=mysql57-community upgrade</code></p>
<p>当前默认是80版本，如果未来需要升级，如果未来一直要维持在57版本，那么建议修改配置文件，以免每次都带上两个参数</p>
<p><code>vim /etc/yum.repos.d/mysql-community.repo</code></p>
<div class="highlight"><pre><span></span><span class="c1"># Enable to use MySQL 5.7</span>
<span class="k">[mysql57-community]</span>
<span class="na">name</span><span class="o">=</span><span class="s">MySQL 5.7 …</span></pre></div></div>
      <div><a class="btn btn-primary" href="https://www.solarck.com/centos6-datebase-server.html"><strong>➟ 查看全文</strong></a></div>
    </article>
    <hr/>

  <nav>
    <ul class="pagination">
        <li class="disabled">
          <a aria-label="Previous" rel="prev">
            <span aria-hidden="true">&larr;</span>
          </a>
        </li>

<li class="active">
            <a href="https://www.solarck.com/index.html"
              rel="
 first ">
              1
                <span class="sr-only">(current)</span>
            </a>
          </li>
<li class="">
            <a href="https://www.solarck.com/index2.html"
              rel="
 next ">
              2
            </a>
          </li>
<li class="">
            <a href="https://www.solarck.com/index3.html"
              rel="
">
              3
            </a>
          </li>
<li class="">
            <a href="https://www.solarck.com/index4.html"
              rel="
 last ">
              4
            </a>
          </li>

        <li>
          <a href="https://www.solarck.com/index2.html"
              aria-label="Next" rel="next">
            <span aria-hidden="true">&rarr;</span>
          </a>
        </li>
    </ul>
  </nav>

        </div>


      </div>

    </div>

    <!-- TODO: make footer sticky -->
    <footer class="container-fluid">
      <div class="container">
        <div class="row">

            <div class="col-md-2">
            </div>
            <div class="col-md-2">
                <h5>链接</h5>
                <ul class="list-unstyled">
                  <li>  <a href="http://getpelican.com/">
      <img src="https://besticon-demo.herokuapp.com/icon?url=getpelican.com&size=16" width="16" height="16" class="icon" alt="getpelican.com icon"/>
    Pelican
  </a></li>
                  <li>  <a href="http://python.org/">
      <img src="https://besticon-demo.herokuapp.com/icon?url=python.org&size=16" width="16" height="16" class="icon" alt="python.org icon"/>
    Python.org
  </a></li>
                  <li>  <a href="http://jinja.pocoo.org/">
      <img src="https://besticon-demo.herokuapp.com/icon?url=jinja.pocoo.org&size=16" width="16" height="16" class="icon" alt="jinja.pocoo.org icon"/>
    Jinja2
  </a></li>
                </ul>
            </div>

          <div class="col-md-2">
            <h5>归档</h5>
            <ul class="list-unstyled">
                <li><a href="https://www.solarck.com/categories.html"><i class="fa fa-tags"></i> Categories</a></li>
                <li><a href="https://www.solarck.com/archives.html"><i class="fa fa-calendar"></i> Dates</a></li>
                <li><a href="https://www.solarck.com/tags.html"><i class="fa fa-tag"></i> Tags</a></li>
            </ul>
          </div>

          <div class="col-md-2 text-muted">
            <h5>Copyright</h5>
            <p>© Copyright 2013-2018 Kevin Chen.</p>
          </div>
        <!--
          <div class="col-md-2 text-muted">
            <h5>Disclaimer</h5>
              <p>All opinions expressed in this site are my own personal opinions and are not endorsed by, nor do they represent the opinions of my previous, current and future employers or any of its affiliates, partners or customers.</p>
          </div>
        -->
          <div class="col-md-2">
              <h5>Feeds</h5>
              <ul class="list-unstyled">
                  <li><small><a href="https://www.solarck.com/feeds/all.atom.xml"><i class="fa fa-rss"></i> All posts (Atom)</a></small></li>
              </ul>
          </div>

        </div>
      </div>

      <h5 class="text-right"><a href="#"><i class="fa fa-arrow-up"></i> Back to top</a></h5>

      <div class="container">
        <div class="row col-md-12 text-muted text-center">
          Site generated by <a href="https://getpelican.com"> Pelican</a>.<br/>
          <a href="https://github.com/kdeldycke/plumage"> Plumage</a> theme by <a href="https://kevin.deldycke.com">Kevin Deldycke</a>.
        </div>
      </div>

    </footer>

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1337838-7', 'auto');
    ga('send', 'pageview');
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"></script>
    <script src="https://www.solarck.com/theme/js/jquery.mglass.js"></script>
    <script src="https://www.solarck.com/theme/js/application.js"></script>

  </body>
</html>