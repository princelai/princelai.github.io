<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>  水星（Mercury）MW4530r刷Openwrt
 | Solarck</title>

    <meta name="author" content="Kevin Chen"/>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css"/>
    <link rel="stylesheet" href="/theme/css/jquery.mglass.css"/>
    <link rel="stylesheet" href="/theme/css/pygment-solarized-dark.css"/>
    <link rel="stylesheet" href="/theme/css/style.css"/>

    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Istok+Web' rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Droid+Sans+Mono' rel='stylesheet' type='text/css'/>
      <link href='https://fonts.googleapis.com/css?family=Expletus+Sans' rel='stylesheet' type='text/css'>


    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <!-- Feeds -->


  </head>

  <body>

    <div class="container">

      <div class="page-header">
          <a href="" class="avatar-container pull-left">
            <div class="avatar ">
              <div class="side"><img src="static/avatar.jpg" class="img-responsive"/></div>
            </div>
          </a>
        <h1><a href="">Solarck</a> <small>金融民工与程序猿的结合体</small></h1>
      </div>

      <nav class="navbar navbar-default">

        <!-- Hamburger menu for mobile -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#plumage-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="" title="金融民工与程序猿的结合体">Solarck</a>
        </div>

        <!-- Menus and search forms -->
        <div class="collapse navbar-collapse" id="plumage-navbar-collapse-1">

          <ul class="nav navbar-nav">
<li >
                <a href="">主页</a>
              </li>
<li >
                <a href="about">关于</a>
              </li>
<li >
                <a href="resume">简历</a>
              </li>
<li  class="active" >
                  <a href="/category/itbi-ji.html">IT笔记 <span class="sr-only">(current)</span></a>
                </li>
<li >
                  <a href="/category/jin-rong-bi-ji.html">金融笔记</a>
                </li>
          </ul>


            <form class="navbar-form navbar-right" role="search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);">
              <div class="form-group">
                <div class="input-group">
                  <input type="text" name="q" id="tipue_search_input" class="form-control search-query" placeholder="Search" required />
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fa
                        fa-search fa-fw"></i></button>
                  </span>
                </div>
              </div>
            </form>

        </div>

      </nav>

    </div>


    <div class="container main">


      <div class="row">
        <div class=" col-md-9  ">
  <h1>
    <a href="/install-openwrt-on-mw4530r.html" rel="bookmark" title="Permalink to 水星（Mercury）MW4530r刷Openwrt">水星（Mercury）MW4530r刷Openwrt</a>
  </h1>
        </div>
      </div>

      <div class="row">


        <div class=" col-md-9 " id="content" role="main">
  

  <div>
    <p>经过两天的不屑折腾，终于为我的Mw4530r安装上了Openwrt。从最后安装成功往回看，其实整个过程非常简单，但是由于是第一次接触，走了不少弯路，本应该一个小时就完成的工作，却整整花了我两天时间。再次发篇文章庆祝下，也给其他朋友一些参考。</p>
<h3>下载文件</h3>
<p>水星这款路由器是ar71xx芯片的，因为较新，所以还没有官方的稳定版。在Openwrt的<a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/">snapshots/trunk</a>目录搜索下载我们需要的刷机文件，一般情况一个型号有两个文件，一个名字里带factory，从其他固件系统刷Openwrt下载这个文件；一个名字带sysupgrade，已经是Openwrt系统的用此文件升级。</p>
<h3>刷机</h3>
<p>组装好路由器，接通电源，电脑网卡口连接路由器任意Lan口，打开浏览器访问http://192.168.1.1&nbsp;就可以看见水星的原厂界面。利用原厂固件的升级功能，提交下载好的Openwrt刷机文件即可直接刷机，非常的方便。稍等片刻等待路由器自动重启，此时刷机完成。</p>
<!--more-->

<h3>初始化</h3>
<p>Openwrt的固件是不带UI界面的，在安装用户界面之前，用户需要先进行简单的初始化工作。  <br>&nbsp;使用telnet登陆路由器</p>
<div class="highlight"><pre><span></span>telnet <span class="m">192</span>.168.1.1
</pre></div>


<p>Linux系统自带命令，Windows用户需要在控制面板&#8212;&gt;程序里面启用telnet功能。</p>
<p>修改登录密码</p>
<div class="highlight"><pre><span></span>passwd
</pre></div>


<p>更改好密码后，dropbear（ssh）登录方式开启，telnet登录方式关闭。</p>
<p>退出telnet，用ssh方式登陆，Windows用户可以下载putty登陆</p>
<div class="highlight"><pre><span></span><span class="nb">exit</span>
ssh root@192.168.1.1
</pre></div>


<p>到此我们已经成功初始化了Openwrt。</p>
<h3>网络配置</h3>
<p><strong>强烈建议基础配置尤其是网络设置都使用CLI界面，切勿乱修改原始配置，我就在这里经历的惨痛的教训</strong><br>&nbsp;我使用的是联通ADSL，所以需要拨号（pppoe）才能上网。     </p>
<p>配置网络连接，修改wan部分</p>
<div class="highlight"><pre><span></span>root@openwrt:~# vi /etc/config/network
config interface <span class="s1">&#39;wan&#39;</span>
    option ifname <span class="s1">&#39;eth0.2&#39;</span>
    option proto <span class="s1">&#39;pppoe&#39;</span>
    option username <span class="s1">&#39;ISP提供的用户名&#39;</span>
    option password <span class="s1">&#39;密码&#39;</span>
</pre></div>


<p>或者用uci方式进行配置</p>
<div class="highlight"><pre><span></span>uci <span class="nb">set</span> network.wan.proto<span class="o">=</span>pppoe
uci <span class="nb">set</span> network.wan.username<span class="o">=</span><span class="s1">&#39;ISP提供的用户名&#39;</span>
uci <span class="nb">set</span> network.wan.password<span class="o">=</span><span class="s1">&#39;密码&#39;</span>
uci commit network
ifup wan
</pre></div>


<p>配置wifi，根据你的路由器配置生成一个默认的配置文件</p>
<div class="highlight"><pre><span></span>wifi detect &gt; /etc/config/wireless
</pre></div>


<p>重启后，互联网和wifi都应该已经正常工作，wifi的密码和名称我们之后可以在UI界面修改，接下来安装用户界面。</p>
<h3>用户界面</h3>
<p>安装Luci    </p>
<div class="highlight"><pre><span></span>opkg update
opkg install luci luci-ssl luci-i18n-chinese
</pre></div>


<p>启动Luci服务</p>
<div class="highlight"><pre><span></span>/etc/init.d/uhttpd start
/etc/init.d/uhttpd <span class="nb">enable</span>
</pre></div>


<p>打开浏览器输入http://192.168.1.1&nbsp;，就可以进入WebUI界面了，现在就可以向普通路由器一样进行管理了。</p>
<h3>小提示</h3>
<blockquote>
<p>1.MW4530r进入failsafe的方法是：路由器断电&#8212;&gt;接通电源&#8212;&gt;断续的按面板前的WPS键，直到SYS指示灯从慢闪变为快闪就是成功进入了failsafe模式了。  <br>
2.初始配置尽量用CLI方式配置（或uci），最好不要用WebUI。&nbsp;3.不要乱动乱删配置文件，尤其是端口路由表（switch0）。</p>
</blockquote>
<p>贴一张Openwrt的路由架构图，这张图帮助我理解了端口和路由的关系。      </p>
<p><img src="http://www.macfreek.nl/memory/images/Linksys_internals.png" title="switch" width="450" /></p>
  </div>



        </div>

          <div class="col-md-3">
  <div class="well">

    <p><abbr title="2014-01-02T01:08:00+08:00"><i class="fa fa-calendar"></i> 一月 02, 2014</abbr></p>

      <p><address>
        <i class="fa fa-user"></i> By
          <a href="/author/kevin-chen.html" rel="author">Kevin Chen</a>
      </address></p>

    <hr/>

      <p>
              <a href="/category/itbi-ji.html" rel="tag"
                  data-toggle="tooltip" class="label label-info"
                  title="13 articles in this category">IT笔记</a>
            <a href="/tag/openwrt.html" data-toggle="tooltip"
      class="label label-default"
      title="3 articles with this tag">openwrt</a>
      </p>
      <hr/>



  </div>
            
          </div>

      </div>

    </div>

    <!-- TODO: make footer sticky -->
    <footer class="container-fluid">
      <div class="container">
        <div class="row">

            <div class="col-md-2">
            </div>
            <div class="col-md-2">
                <h5>链接</h5>
                <ul class="list-unstyled">
                  <li>  <a href="http://getpelican.com/">
      <img src="https://besticon-demo.herokuapp.com/icon?url=getpelican.com&size=16" width="16" height="16" class="icon" alt="getpelican.com icon"/>
    Pelican
  </a></li>
                  <li>  <a href="http://python.org/">
      <img src="https://besticon-demo.herokuapp.com/icon?url=python.org&size=16" width="16" height="16" class="icon" alt="python.org icon"/>
    Python.org
  </a></li>
                  <li>  <a href="http://jinja.pocoo.org/">
      <img src="https://besticon-demo.herokuapp.com/icon?url=jinja.pocoo.org&size=16" width="16" height="16" class="icon" alt="jinja.pocoo.org icon"/>
    Jinja2
  </a></li>
                </ul>
            </div>

          <div class="col-md-2">
            <h5>归档</h5>
            <ul class="list-unstyled">
                <li><a href="/categories.html"><i class="fa fa-tags"></i> Categories</a></li>
                <li><a href="/archives.html"><i class="fa fa-calendar"></i> Dates</a></li>
                <li><a href="/tags.html"><i class="fa fa-tag"></i> Tags</a></li>
            </ul>
          </div>

          <div class="col-md-2 text-muted">
            <h5>Copyright notice</h5>
            <p>© Copyright 2013-2018 Kevin Chen.</p>
          </div>
        <!--
          <div class="col-md-2 text-muted">
            <h5>Disclaimer</h5>
              <p>All opinions expressed in this site are my own personal opinions and are not endorsed by, nor do they represent the opinions of my previous, current and future employers or any of its affiliates, partners or customers.</p>
          </div>
        -->
          <div class="col-md-2">
          </div>

        </div>
      </div>

      <h5 class="text-right"><a href="#"><i class="fa fa-arrow-up"></i> Back to top</a></h5>

      <div class="container">
        <div class="row col-md-12 text-muted text-center">
          Site generated by <a href="https://getpelican.com"> Pelican</a>.<br/>
          <a href="https://github.com/kdeldycke/plumage"> Plumage</a> theme by <a href="https://kevin.deldycke.com">Kevin Deldycke</a>.
        </div>
      </div>

    </footer>

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1337838-7', 'auto');
    ga('send', 'pageview');
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"></script>
    <script src="/theme/js/jquery.mglass.js"></script>
    <script src="/theme/js/application.js"></script>

  </body>
</html>